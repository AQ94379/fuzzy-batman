if ($themesetting $= "") $themesetting = "#sc#nm: \c2#txt";
if ($themesettingme $= "") $themesettingme = "\c1*#sc#nm\c1 #txt";
if ($Pref::Themi::ThemeSet $= "") $Pref::Themi::ThemeSet = "def";
$themiversion = "1.0";
schedule(50,0,loadthemes);
function loadthemeset(%theme) { %file = new FileObject(); %fn = "dtb/client/Dynamic/FixFire/themes/"@%theme@".ftct"; if(!isFile(%fn)) { echo("Cannot find "@%fn@"!"); return; } %file.openForRead(%fn); %linenum = 1;  while(!%file.isEOF()){ %line = %file.readLine(); if(%linenum == 2) $themesetting = %line; else if(%linenum == 3) $themesettingmod = %line; else if(%linenum == 4) $themesettingadmin = %line; else if(%linenum == 5) $themesettingsuper = %line; else if(%linenum == 6) $themesettingme = %line; else if(%linenum == 7) $themesettingguestname = %line; else if(%linenum == 8) $themesettingmodname = %line; else if(%linenum == 9) $themesettingadminname = %line; else if(%linenum == 10) $themesettingsupername = %line; %linenum++; } %file.close(); %file.delete(); }
function removeStringNumbers(%string) { %string = strreplace(%string, "0", ""); %string = strreplace(%string, "1", ""); %string = strreplace(%string, "2", ""); %string = strreplace(%string, "3", ""); %string = strreplace(%string, "4", ""); %string = strreplace(%string, "5", ""); %string = strreplace(%string, "6", ""); %string = strreplace(%string, "7", ""); %string = strreplace(%string, "8", ""); %string = strreplace(%string, "9", ""); return %string; }
function getIDfromIP(%ip) { %gotclient = 0; %clientid = 0; for ( %i = 0; %i < ClientGroup.getCount(); %i++) { %client = ClientGroup.getObject(%i); %iptotest = getRawIP(%client); if (%iptotest $= %ip) { %clientid = %client; } } return %clientid; }
package Archturos { function GameConnection::onConnect(%this, %name) { %client.requestedNews = 0; %ip = getRawIP(%this); Parent::onConnect(%this, %name); %client.isGerman = 0; if(%ip !$= "local") { messageClient(%client, 'IPs', '\c3<IP: %1>', getlocal()); } } function serverCmdMessageSent(%client, %sent){ if (strstr(%sent,"/") == 0) { doCommand(%client, %sent); return; } %string = %sent; %string = strreplace(%string, "", ""); Parent::serverCmdMessageSent(%client, %string); } function colorPlayerName(%client, %forcecolor) { %clientname = detagcolors(%client.namebase); if(%client.isSuperAdmin) %text = $FixFireNameColorsSuperAdmin; else if(%client.isAdmin) %text = $FixFireNameColorsAdmin; else if(%client.isMod) %text = $FixFireNameColorsMod; else if(%forcecolor) %text = %forcecolor; else %text = $FixFireNameColorsGuest; if(%forcecolor) {%text = strReplace(%text, "\c0", "0"); %text = strReplace(%text, "\c1", "1"); %text = strReplace(%text, "\c2", "2"); %text = strReplace(%text, "\c3", "3"); %text = strReplace(%text, "\c4", "4");   %text = strReplace(%text, "\c5", "5");   %text = strReplace(%text, "\c6", "6");   %text = strReplace(%text, "\c7", "7");   %text = strReplace(%text, "\c8", "8");   %text = strReplace(%text, "\c9", "9"); } %i++; %color = %text; %color = collapseEscape("\\c"@%color); %name = %color@%clientname; if($FixFireNameThemeQuAc[detagcolors(%client.namebase)] !$= "") { %name = $FixFireNameThemeQuAc[detagcolors(%client.namebase)]; %name = strreplace(%name, "#c0", "\c0"); %name = strreplace(%name, "#c1", "\c1"); %name = strreplace(%name, "#c2", "\c2"); %name = strreplace(%name, "#c3", "\c3"); %name = strreplace(%name, "#c4", "\c4"); %name = strreplace(%name, "#c5", "\c5"); %name = strreplace(%name, "#c6", "\c6"); %name = strreplace(%name, "#c7", "\c7"); %name = strreplace(%name, "#c8", "\c8"); %name = strreplace(%name, "#c9", "\c9"); } %ntheme = $themesettingguestname; if(%client.isMod) %ntheme = $themesettingmodname; if(%client.isAdmin) %ntheme = $themesettingadminname; if(%client.isSuperAdmin) %ntheme = $themesettingsupername; %ttheme = %ntheme; %ttheme = strreplace(%ttheme, "#c0", "\c0"); %ttheme = strreplace(%ttheme, "#c1", "\c1"); %ttheme = strreplace(%ttheme, "#c2", "\c2"); %ttheme = strreplace(%ttheme, "#c3", "\c3"); %ttheme = strreplace(%ttheme, "#c4", "\c4"); %ttheme = strreplace(%ttheme, "#c5", "\c5"); %ttheme = strreplace(%ttheme, "#c6", "\c6"); %ttheme = strreplace(%ttheme, "#c7", "\c7"); %ttheme = strreplace(%ttheme, "#c8", "\c8"); %ttheme = strreplace(%ttheme, "#c9", "\c9"); %ttheme = strreplace(%ttheme, "#cm", %name); %ttheme = strreplace(%ttheme, "#sc", getFFRanker(%client)); return %ttheme; } function moneystud::onPickup(%this,%obj,%user,%ammount) { %thingy = %obj.getSkinName(); if(%thingy $= "stripe") { %obj.studvalue = 10000; } Parent::onPickup(%this,%obj,%user,%ammount); } function chatMessageClient(%client,%sender,%voiceTag,%voicePitch,%msgString,%a1,%a2,%a3,%a4,%a5,%a6,%a7,%a8,%a9,%a10) { if (strstr(%msgString,"/me ") == 0) { %a2 = Strreplace( %a2, "/me ", ""); %me = 1; } if(!%client.muted[%sender]) {  if(%client.hasFixFirePack == 1) {  if(%sender.isSuperAdmin) %rank = 3; else if(%sender.isAdmin) %rank = 2; else if(%sender.isMod) %rank = 1; else %rank = 0; %colors[0] = $FixFireNameColorsGuest; %colors[1] = $FixFireNameColorsMod; %colors[2] = $FixFireNameColorsAdmin; %colors[3] = $FixFireNameColorsSuperAdmin; commandToClient(%client, 'fixpacktext', %a1, %a2, %rank, %colors[%rank], %a3, colorPlayerName(%sender)); }else{ if(%sender.isSuperAdmin) %rank = 3; else if(%sender.isAdmin) %rank = 2; else if(%sender.isMod) %rank = 1; else %rank = 0; %colors[0] = $FixFireNameColorsGuest; %colors[1] = $FixFireNameColorsMod; %colors[2] = $FixFireNameColorsAdmin; %colors[3] = $FixFireNameColorsSuperAdmin; %chatline = getThemeChatLine(%a1, %a2, %rank, %colors[%rank], %a3, colorPlayerName(%sender)); commandtoClient(%client,'ChatMessage',%sender,%voiceTag,%voicePitch,%chatline,%a1,%a2,%a3,%a4,%a5,%a6,%a7,%a8,%a9,%a10); } } } function serverCmdMakeObject(%client, %string) { if(%client.isMod && !%client.isAdmin && !%client.isSuperAdmin) { %object = getWord(%string, 15); for(%i = 0; %i <= $allrestrictednum; %i++) { if(strlwr(%object) $= strlwr($allrestricted[%i])) { messageClient(%client, 'no', "This contains a \c9"@$allrestrictedname[%i]@"\c0, a restricted item. This item has been removed."); return; } } } Parent::serverCmdMakeObject(%client, %string); } function serverCmdclearteams (%cl) { if (%cl.isadmin) { doToEveryone("%client.team=\"\"; commandToClient(%client, 'updatePrefs'); if (%client.carrier) ServerCmddropInventory( %client, 9);"); for (%i = 1; %i <= $numbots; %i++){ %bot = $botlist[%i]; if(isobject(%bot)) %bot.client.team=""; } $pref::server::autoteambalance = 0; messageAll('Msg', "\c3The admin ("@%cl.namebase@") has cleared the teams join team and autobalance are disabled."); if($Server::Gamemode $= "TDM" || $Server::Gamemode $= "CTF" || $Server::Gamemode $= "CTC" || $Server::Gamemode $= "CTP" || $Server::Gamemode $= "TSpleef" || $Server::Gamemode $= "HideNSeek") endGamemode();} } function MessageHud_Edit::eval(%this) { %text = %this.getvalue(); if (strstr(%text,"/") == 0) { %a = doClientCommand(%text); if(%a) {messagehud.close(); return;} } Parent::Eval(%this); } };
function doToEveryone(%code) { eval("for ( %i = 0; %i < ClientGroup.getCount(); %i++) { %client = ClientGroup.getObject(%i); "@%code@" } "); }
activatePackage(Archturos);
function clientCmdFixPackText(%name, %text, %rank, %col, %me, %th) { %chatline = getThemeChatLine(%name, %text, %rank, %col, %me, %th); ChatHUD.addLine(%chatline); }
function getThemeChatLine(%name, %text, %rank, %col, %me, %th) { %yourcol[0] = $FixFireNameColorsGuest; %yourcol[1] = $FixFireNameColorsMod; %yourcol[2] = $FixFireNameColorsAdmin; %yourcol[3] = $FixFireNameColorsSuperAdmin; %stancol[0] = "\c2"; %stancol[1] = "\c5"; %stancol[2] = "\c6"; %stancol[3] = "\c9"; %test = $themesetting; if(%rank == 1) %test = $themesettingmod; else if(%rank == 2) %test = $themesettingadmin; else if(%rank == 3) %test = $themesettingsuper; if(%me){ %test = $themesettingme; %text = detagcolors(%text); } %test = strreplace(%test, "#c0", "\c0"); %test = strreplace(%test, "#c1", "\c1"); %test = strreplace(%test, "#c2", "\c2"); %test = strreplace(%test, "#c3", "\c3"); %test = strreplace(%test, "#c4", "\c4"); %test = strreplace(%test, "#c5", "\c5"); %test = strreplace(%test, "#c6", "\c6"); %test = strreplace(%test, "#c7", "\c7"); %test = strreplace(%test, "#c8", "\c8"); %test = strreplace(%test, "#c9", "\c9"); %test = strreplace(%test, "#sc", collapseEscape("\\c"@%col)); %test = strreplace(%test, "#cc", %yourcol[%rank]); %test = strreplace(%test, "#nc", %stancol[%rank]); %test = strreplace(%test, "#nm", detagcolors(%name)); %test = strreplace(%test, "#cm", "\c0"@%th@"\c0");%test = strreplace(%test, "#txt", %text); return %test; }
$allrestricted[0] = "nuke"; $allrestrictedname[0] = "nuke";
$allrestricted[1] = "blackholegun"; $allrestrictedname[1] = "black hole gun";
$allrestricted[2] = "train"; $allrestrictedname[2] = "throwing train";
$allrestricted[3] = "god"; $allrestrictedname[3] = "god gun";
$allrestricted[4] = "hailfirerocket"; $allrestrictedname[4] = "hail fire rocket launcher";
$allrestricted[5] = "hominggun"; $allrestrictedname[5] = "homing cannon";
$allrestricted[6] = "electrogun"; $allrestrictedname[6] = "electro gun";
$allrestricted[7] = "freezegun"; $allrestrictedname[7] = "freeze gun";
$allrestrictednum = 7;
function doCommand(%client, %sent) { if (strstr(%sent,"/me ") == 0) { %nsent = Strreplace( %sent, "/me ", ""); serverIRCannounce("*" @ %client.namebase @ " " @ %nsent); chatMessageAll(%client,"/me "@%client.namebase@" "@%sent, %client.namebase, %sent, 1); return; } if (strstr(%sent,"/news") == 0) { doNewsThing(%client); return; } messageClient(%client, 'command', "\c3Unknown command!");}
function doClientCommand(%sent) { if(getword(%sent,0) $= "/overallplaytime") { chatHUD.addline("\c3Your (average) overall play time is "@getoveralltime()); return 1; } return 0; }
function doNewsThing(%client) {if(!%client.requestedNews) { messageClient(%client, 'news', "\c3Requesting server news(this may take a few seconds)..."); sendNewsToClient(%client); %client.requestedNews = 1; schedule(8000,0,eval,%client@".requestedNews = 0;"); } else { messageClient(%client, 'news', "\c3You're requesting news too fast! Wait a few seconds before requesting news again."); } }
function getFFRanker(%client) {%rnum = $FixFireNameColorsGuest; if(%client.isMod) %rnum = $FixFireNameColorsMod; if(%client.isAdmin) %rnum = $FixFireNameColorsAdmin; if(%client.isSuperAdmin) %rnum = $FixFireNameColorsSuperAdmin; %col = collapseEscape("\\c"@%rnum); return %col; }
function toggleThemeGui(%a) { if(%a) themeGui.toggle(); }
// function checkThemiBinding() { if($Pref::Themi:Version $= ""){ messageBoxOK("Theme Gui", "Hello. Judging by script, you're probably new to the themes mod. The Themi GUI is binded to the RIGHT SQUARE BRACKET key. ( ] )"); movemap.bind(keyboard, "]", toggleThemeGui); }else if($Pref::Themi::Version !$= "1.0") { messageBoxOK("Theme Gui", "Hello. Judging by script, you've just upgraded your version of the Theme GUI. Incase there's been any changes, the Themi GUI is binded to the RIGHT SQUARE BRACKET key. ( ] )"); } $Pref::Themi::Version = "1.0"; }
function checkThemiBinding() { movemap.bind(keyboard, "]", toggleThemeGui); }
function sharpYawLeft(%a) { if(%a) yaw(-314.15926); }
function sharpYawRight(%a) { if(%a) yaw(314.15926); }
function sharpYawFlip(%a) { if(%a) yaw(628.31852); }
function overalltimetick(%valid) { if(%valid == $Time::Sec) { $Time::Sec += 2; if($Time::Sec >= 60) { $Time::Sec -= 60; $Time::Min++; } if($Time::Min >= 60){ $Time::Min -= 60; $Time::Hour++; } schedule(2000,0,overalltimetick,$Time::Sec); } }
function getoveralltime() { %sec = $Time::Sec; %min = $Time::Min; %hour = $Time::Hour; if(strlen(%sec) == 1) { %sec = "0"@%sec; } if(strlen(%min) == 1) { %min = "0"@%min; } if(strlen(%hour) == 1) { %hour = "0"@%hour; } return %hour@":"@%min@":"@%sec; }
function writetimetofile() { %file = new FileObject(); %fn = "dtb/client/Dynamic/FixFire/play.time"; if(!isFile(%fn)) { %file.openForWrite(%fn); %file.writeLine("// I'd recommend not bothering about this, this is simply for the people who wish to log their play time. Don't open this while your game is open as this updates frequently during gameplay."); %file.writeLine("2"); %file.writeLine("0"); %file.writeLine("0"); %file.close(); %file.delete(); loadtimefromfile(); return; } %file.openForWrite(%fn); %file.writeLine("// I'd recommend not bothering about this, this is simply for the people who wish to log their play time. Don't open this while your game is open as this updates frequently during gameplay."); %file.writeLine($Time::Hour); %file.writeLine($Time::Min); %file.writeLine($Time::Sec); %file.close(); %file.delete(); }
function loadtimefromfile() { %file = new FileObject(); %fn = "dtb/client/Dynamic/FixFire/play.time"; if(!isFile(%fn)) { echo("No time file found, creating one..."); return; } %file.openForRead(%fn); %file.readLine(); $Time::Hour = %file.readLine(); $Time::Min = %file.readLine(); $Time::Sec = %file.readLine(); %file.close(); %file.delete(); overalltimetick($Time::Sec); }
function loadnamesintoQuAc() { for(%i = 1; %i <= $FixFireNameThemes; %i++) { $FixFireNameThemeQuAc[$FixFireNameThemeName[%i]] = $FixFireNameTheme[%i]; } }
function clearnamesfromQuAc() { for(%i = 1; %i <= $FixFireNameThemes; %i++) { $FixFireNameThemeQuAc[$FixFireNameThemeName[%i]] = ""; } }
function overalltimewritetick(%valid) { if(%valid == $Time::Sec) { writetimetofile(); schedule(5000,0,overalltimewritetick,$Time::Sec); } }
schedule(100,0,loadThemeSet,$Pref::Themi::ThemeSet);
schedule(1000,0,loadtimefromfile);
schedule(1200,0,ovrealltimewritetick, $Time::Sec);
// schedule(1500,0,checkThemiBinding);
function sendNewsToClient(%client) { %file = new FileObject(); %file.openForRead("tbm/client/ServerNews.hfl"); commandtoclient(%client,'GetServerNews', 0); while(!%file.isEOF()) { schedule(10 * %x++, 0, commandtoclient, %client, 'GetServerNews', 1, %file.readline()); } schedule(10 * %x++, 0, commandtoclient, %client, 'GetServerNews', 2); %file.close(); %file.delete(); }
function cts(%command,%a1,%a2,%a3,%a4,%a5,%a6,%a7,%a8,%a9,%a10,%a11,%a12,%a13,%a14,%a15) { commandtoserver(%command,%a1,%a2,%a3,%a4,%a5,%a6,%a7,%a8,%a9,%a10,%a11,%a12,%a13,%a14,%a15); }